{"version":3,"sources":["skylark-io-readers.js"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"../skylark-io-readers.js","sourcesContent":["define('skylark-io-readers/readers',[\r\n    \"skylark-langx-ns\"\r\n], function(skylark) {\r\n\r\n    return skylark.attach(\"io.readers\");\r\n});\r\n\ndefine('skylark-io-readers/_reader',[\n    \"skylark-langx-events\",\n    \"./readers\"\n], function(events,readers) {\n\n    'use strict';\n\n    var Reader = events.Emitter.inherit({\n        klassName: \"Reader\",\n        _construct :  function(data) {\n            this.data = data;\n            this.length = data.length;\n            this.index = 0;\n            this.zero = 0;\n        },\n\n        checkOffset: function (offset) {\n            this.checkIndex(this.index + offset);\n        },\n        checkIndex: function (newIndex) {\n            if (this.length < this.zero + newIndex || newIndex < 0) {\n                throw new Error('End of data reached (data length = ' + this.length + ', asked index = ' + newIndex + '). Corrupted zip ?');\n            }\n        },\n        setIndex: function (newIndex) {\n            this.checkIndex(newIndex);\n            this.index = newIndex;\n        },\n        skip: function (n) {\n            this.setIndex(this.index + n);\n        },\n        byteAt: function () {\n        },\n        readInt: function (size) {\n            var result = 0, i;\n            this.checkOffset(size);\n            for (i = this.index + size - 1; i >= this.index; i--) {\n                result = (result << 8) + this.byteAt(i);\n            }\n            this.index += size;\n            return result;\n        },\n        readString: function (size) {\n            return utils.transformTo('string', this.readData(size));\n        },\n        readData: function () {\n        },\n        lastIndexOfSignature: function () {\n        },\n        readAndCheckSignature: function () {\n        },\n        readDate: function () {\n            var dostime = this.readInt(4);\n            return new Date(Date.UTC((dostime >> 25 & 127) + 1980, (dostime >> 21 & 15) - 1, dostime >> 16 & 31, dostime >> 11 & 31, dostime >> 5 & 63, (dostime & 31) << 1));\n        }\n\n    });\n\n    return readers.Reader = Reader;\n});\ndefine('skylark-io-readers/array-reader',[\n    \"./readers\",\n    './_reader'\n], function (readers,Reader) {\n    'use strict';\n\n    var ArrayReader = Reader.inherit({\n        klassName: \"ArrayReader\",\n        _construct :  function(data) {\n            Reader.prototype._construct.call(this,data);\n            for (var i = 0; i < this.data.length; i++) {\n                data[i] = data[i] & 255;\n            }            \n        },\n\n\n        byteAt : function (i) {\n            return this.data[this.zero + i];\n        },\n\n        lastIndexOfSignature : function (sig) {\n            var sig0 = sig.charCodeAt(0), sig1 = sig.charCodeAt(1), sig2 = sig.charCodeAt(2), sig3 = sig.charCodeAt(3);\n            for (var i = this.length - 4; i >= 0; --i) {\n                if (this.data[i] === sig0 && this.data[i + 1] === sig1 && this.data[i + 2] === sig2 && this.data[i + 3] === sig3) {\n                    return i - this.zero;\n                }\n            }\n            return -1;\n        },\n\n        readAndCheckSignature : function (sig) {\n            var sig0 = sig.charCodeAt(0), sig1 = sig.charCodeAt(1), sig2 = sig.charCodeAt(2), sig3 = sig.charCodeAt(3), data = this.readData(4);\n            return sig0 === data[0] && sig1 === data[1] && sig2 === data[2] && sig3 === data[3];\n        },\n\n        readData : function (size) {\n            this.checkOffset(size);\n            if (size === 0) {\n                return [];\n            }\n            var result = this.data.slice(this.zero + this.index, this.zero + this.index + size);\n            this.index += size;\n            return result;\n        }\n    });\n\n    return readers.ArrayReader = ArrayReader;\n});\ndefine('skylark-io-readers/uint8-array-reader',[\n    \"./readers\",\n    './array-reader'\n], function (readers,ArrayReader) {\n    'use strict';\n\n    var Uint8ArrayReader = ArrayReader.inherit({\n        klassName: \"Uint8ArrayReader\",\n\n        readData : function (size) {\n            this.checkOffset(size);\n            if (size === 0) {\n                return new Uint8Array(0);\n            }\n            var result = this.data.subarray(this.zero + this.index, this.zero + this.index + size);\n            this.index += size;\n            return result;\n        }\n    });\n\n\n    return readers.Uint8ArrayReader = Uint8ArrayReader;\n\n});\ndefine('skylark-io-readers/buffer-reader',[\n    \"./readers\",\n    './uint8-array-reader'\n], function (readers,Reader) {\n    'use strict';\n\n\n    var BufferReader = ArrayReader.inherit({\n        klassName: \"BufferReader\",\n\n        readData : function (size) {\n            this.checkOffset(size);\n            var result = this.data.slice(this.zero + this.index, this.zero + this.index + size);\n            this.index += size;\n            return result;\n        }\n    });\n\n\n    return readers.BufferReader = BufferReader;\n});\ndefine('skylark-io-readers/string-reader',[\n    \"./readers\",\n    './_reader'\n], function (readers,Reader) {\n    'use strict';\n\n    var StringReader = Reader.inherit({\n        klassName: \"StringReader\",\n\n        byteAt : function (i) {\n            return this.data.charCodeAt(this.zero + i);\n        },\n\n        lastIndexOfSignature : function (sig) {\n            return this.data.lastIndexOf(sig) - this.zero;\n        },\n\n        readAndCheckSignature : function (sig) {\n            var data = this.readData(4);\n            return sig === data;\n        },\n\n        readData : function (size) {\n            this.checkOffset(size);\n            var result = this.data.slice(this.zero + this.index, this.zero + this.index + size);\n            this.index += size;\n            return result;\n        }\n    });\n    \n    return readers.StringReader = StringReader;\n});\ndefine('skylark-io-readers/main',[\r\n    \"./readers\",\r\n    \"./array-reader\",\r\n    \"./buffer-reader\",\r\n    \"./string-reader\",\r\n    \"./uint8-array-reader\"\r\n], function(readers) {\r\n\r\n\treturn readers;\r\n});\ndefine('skylark-io-readers', ['skylark-io-readers/main'], function (main) { return main; });\n\n"]}