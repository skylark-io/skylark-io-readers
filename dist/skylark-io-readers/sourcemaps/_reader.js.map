{"version":3,"sources":["_reader.js"],"names":["define","events","readers","Reader","Emitter","inherit","klassName","_construct","data","this","length","index","zero","checkOffset","offset","checkIndex","newIndex","Error","setIndex","skip","n","byteAt","readInt","size","i","result","readString","utils","transformTo","readData","lastIndexOfSignature","readAndCheckSignature","readDate","dostime","Date","UTC"],"mappings":";;;;;;;AAAAA,QACI,uBACA,aACD,SAASC,EAAOC,GAEf,aAEA,IAAIC,EAASF,EAAOG,QAAQC,SACxBC,UAAW,SACXC,WAAc,SAASC,GACnBC,KAAKD,KAAOA,EACZC,KAAKC,OAASF,EAAKE,OACnBD,KAAKE,MAAQ,EACbF,KAAKG,KAAO,GAGhBC,YAAa,SAAUC,GACnBL,KAAKM,WAAWN,KAAKE,MAAQG,IAEjCC,WAAY,SAAUC,GAClB,GAAIP,KAAKC,OAASD,KAAKG,KAAOI,GAAYA,EAAW,EACjD,MAAM,IAAIC,MAAM,sCAAwCR,KAAKC,OAAS,mBAAqBM,EAAW,uBAG9GE,SAAU,SAAUF,GAChBP,KAAKM,WAAWC,GAChBP,KAAKE,MAAQK,GAEjBG,KAAM,SAAUC,GACZX,KAAKS,SAAST,KAAKE,MAAQS,IAE/BC,OAAQ,aAERC,QAAS,SAAUC,GACf,IAAgBC,EAAZC,EAAS,EAEb,IADAhB,KAAKI,YAAYU,GACZC,EAAIf,KAAKE,MAAQY,EAAO,EAAGC,GAAKf,KAAKE,MAAOa,IAC7CC,GAAUA,GAAU,GAAKhB,KAAKY,OAAOG,GAGzC,OADAf,KAAKE,OAASY,EACPE,GAEXC,WAAY,SAAUH,GAClB,OAAOI,MAAMC,YAAY,SAAUnB,KAAKoB,SAASN,KAErDM,SAAU,aAEVC,qBAAsB,aAEtBC,sBAAuB,aAEvBC,SAAU,WACN,IAAIC,EAAUxB,KAAKa,QAAQ,GAC3B,OAAO,IAAIY,KAAKA,KAAKC,IAA4B,MAAvBF,GAAW,GAAK,MAAcA,GAAW,GAAK,IAAM,EAAGA,GAAW,GAAK,GAAIA,GAAW,GAAK,GAAIA,GAAW,EAAI,IAAe,GAAVA,IAAiB,OAKtK,OAAO/B,EAAQC,OAASA","file":"../_reader.js","sourcesContent":["define([\n    \"skylark-langx-events\",\n    \"./readers\"\n], function(events,readers) {\n\n    'use strict';\n\n    var Reader = events.Emitter.inherit({\n        klassName: \"Reader\",\n        _construct :  function(data) {\n            this.data = data;\n            this.length = data.length;\n            this.index = 0;\n            this.zero = 0;\n        },\n\n        checkOffset: function (offset) {\n            this.checkIndex(this.index + offset);\n        },\n        checkIndex: function (newIndex) {\n            if (this.length < this.zero + newIndex || newIndex < 0) {\n                throw new Error('End of data reached (data length = ' + this.length + ', asked index = ' + newIndex + '). Corrupted zip ?');\n            }\n        },\n        setIndex: function (newIndex) {\n            this.checkIndex(newIndex);\n            this.index = newIndex;\n        },\n        skip: function (n) {\n            this.setIndex(this.index + n);\n        },\n        byteAt: function () {\n        },\n        readInt: function (size) {\n            var result = 0, i;\n            this.checkOffset(size);\n            for (i = this.index + size - 1; i >= this.index; i--) {\n                result = (result << 8) + this.byteAt(i);\n            }\n            this.index += size;\n            return result;\n        },\n        readString: function (size) {\n            return utils.transformTo('string', this.readData(size));\n        },\n        readData: function () {\n        },\n        lastIndexOfSignature: function () {\n        },\n        readAndCheckSignature: function () {\n        },\n        readDate: function () {\n            var dostime = this.readInt(4);\n            return new Date(Date.UTC((dostime >> 25 & 127) + 1980, (dostime >> 21 & 15) - 1, dostime >> 16 & 31, dostime >> 11 & 31, dostime >> 5 & 63, (dostime & 31) << 1));\n        }\n\n    });\n\n    return readers.Reader = Reader;\n});"]}